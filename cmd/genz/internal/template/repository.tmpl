// THIS FILE IS AUTO GENERATED by genz.

package repository

import (
	"{{ .Module }}/internal/base"
	"{{ .Module }}/internal/model"
	"github.com/google/uuid"
)

type {{ ToPascalCase .StructName }}Repository interface {
  Create({{ ToCamelCase .StructName }} model.{{ ToPascalCase .StructName }}) error
  FindByID(id uuid.UUID) (*model.{{ ToPascalCase .StructName }}, error)
  Update(id uuid.UUID, {{ ToCamelCase .StructName }}Map base.UpdateMap) error
  Delete(id uuid.UUID) error
}

type {{ ToPascalCase .StructName }}QueryBuilder struct{ repo base.Repository }

func NewRepo(repo base.Repository) {{ ToPascalCase .StructName }}Repository {
  return {{ ToPascalCase .StructName }}QueryBuilder{repo: repo}
}

func (q {{ ToPascalCase .StructName }}QueryBuilder) Create({{ ToCamelCase .StructName }} model.{{ ToPascalCase .StructName }}) error {
  return q.repo.DB().Create(&{{ ToCamelCase .StructName }}).Error
}

func (q {{ ToPascalCase .StructName }}QueryBuilder) FindByID(id uuid.UUID) (*model.{{ ToPascalCase .StructName }}, error) {
  {{ ToCamelCase .StructName }} := model.{{ ToPascalCase .StructName }}{}
  if err := q.repo.DB().First({{ ToCamelCase .StructName }}, id).Error; err != nil {
    return nil, err
  }

  return &{{ ToCamelCase .StructName }}, nil
}

func (q {{ ToPascalCase .StructName }}QueryBuilder) Update(id uuid.UUID, {{ ToCamelCase .StructName }}Map base.UpdateMap) error {
  {{ ToCamelCase .StructName }}, err := q.FindByID(id)
  if err != nil {
    return err
  }

  return q.repo.DB().Model({{ ToCamelCase .StructName }}).Updates({{ ToCamelCase .StructName }}Map).Error
}

func (q {{ ToPascalCase .StructName }}QueryBuilder) Delete(id uuid.UUID) error {
  return q.repo.DB().Delete(model.{{ ToPascalCase .StructName }}{}, id).Error
}